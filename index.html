<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Privacy Policy Generator</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        background: #f7f7f9;
      }
      header {
        background: #333;
        color: #fff;
        padding: 1rem;
        text-align: center;
      }
      main {
        max-width: 900px;
        margin: 2rem auto;
        background: #fff;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }
      section {
        margin-top: 1.5rem;
      }
      h2 {
        margin-bottom: 0.5rem;
        font-size: 1.2rem;
        color: #333;
      }
      label {
        font-weight: bold;
        display: block;
        margin-top: 1rem;
      }
      input[type="text"] {
        width: 100%;
        padding: 0.5rem;
        font-size: 1rem;
        border: 1px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
        margin-top: 0.25rem;
      }
      button {
        margin-top: 1.5rem;
        background: #0069d9;
        color: #fff;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
      }
      button:hover {
        background: #0053ba;
      }
      #result {
        margin-top: 1.5rem;
        white-space: pre-wrap;
        background: #f0f0f0;
        padding: 1rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        max-height: 400px;
        overflow-y: auto;
        display: none;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Privacy Policy Generator</h1>
    </header>
    <main>
      <p>
        Fill out the information below and click <strong>Generate</strong>.
        The completed policy will display on the page and download as a PDF.
      </p>
      <form id="policyForm">
        <section>
          <h2>Organization Details</h2>
          <label for="companyName">Company name</label>
          <input type="text" id="companyName" name="companyName" required />
          <label for="nameSystem">Name of record system</label>
          <input type="text" id="nameSystem" name="nameSystem" />
          <label for="ceoName">CEO name</label>
          <input type="text" id="ceoName" name="ceoName" />
          <label for="approvalDate">Approval date</label>
          <input type="text" id="approvalDate" name="approvalDate" />
        </section>
        <button type="submit">Generate</button>
      </form>
      <div id="result"></div>
    </main>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
      async function loadTemplate() {
        const response = await fetch('policy-template.txt');
        return await response.text();
      }

      function replacePlaceholders(text, replacements) {
        let output = text;
        for (const key in replacements) {
          const regex = new RegExp(`\\[${key}\\]`, 'g');
          output = output.replace(regex, replacements[key] || '');
        }
        return output;
      }

      document.getElementById('policyForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const replacements = {
          'CUSTOMER_NAME': formData.get('companyName').trim(),
          'NAME_SYSTEM': formData.get('nameSystem').trim(),
          'CEO_NAME': formData.get('ceoName').trim(),
          'APPROVAL_DATE': formData.get('approvalDate').trim(),
        };

        const template = await loadTemplate();
        const filled = replacePlaceholders(template, replacements);

        const resultDiv = document.getElementById('result');
        resultDiv.textContent = filled;
        resultDiv.style.display = 'block';

        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFont('times', 'normal');
        doc.setFontSize(12);
        const lines = filled.split('\n');
        const pageHeight = doc.internal.pageSize.getHeight();
        const pageWidth = doc.internal.pageSize.getWidth();
        const margin = 20;
        let y = margin;

        lines.forEach((line) => {
          const split = doc.splitTextToSize(line, pageWidth - margin * 2);
          split.forEach((sLine) => {
            if (y > pageHeight - margin) {
              doc.addPage();
              y = margin;
            }
            if (/^\\d+(\.\\d+)*\s/.test(sLine) || /^Exhibit/.test(sLine)) {
              doc.setFont(undefined, 'bold');
            } else {
              doc.setFont(undefined, 'normal');
            }
            doc.text(sLine, margin, y);
            y += 14;
          });
        });

        doc.save('privacy_policy.pdf');
      });
    </script>
  </body>
</html>
